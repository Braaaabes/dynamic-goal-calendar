<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dynamic Goal Calendar</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    .calendar {
      display: grid;
      grid-template-columns: 80px repeat(7, 1fr);
      width: 100%;
    }
    .calendar-header {
      display: contents;
    }
    .calendar-header div {
      background: #f2f2f2;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      border-bottom: 1px solid #ccc;
    }
    .time-cell {
      background: #fafafa;
      padding: 5px;
      border-bottom: 1px solid #eee;
      text-align: right;
      font-size: 12px;
    }
    .day-column {
      border-left: 1px solid #eee;
      position: relative;
    }
    .event {
      position: absolute;
      background: #90caf9;
      border: 1px solid #42a5f5;
      padding: 4px;
      font-size: 12px;
      color: #000;
      border-radius: 4px;
      cursor: pointer;
      z-index: 2;
    }
    .now-line {
      position: absolute;
      height: 2px;
      background: red;
      z-index: 3;
      width: 100%;
    }
    .popup {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border: 1px solid #ccc;
      padding: 20px;
      z-index: 10;
      width: 300px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    .popup input,
    .popup select {
      width: 100%;
      margin-bottom: 10px;
      padding: 6px;
    }
    .popup button {
      margin-right: 10px;
    }
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.3);
      z-index: 9;
    }
  </style>
</head>
<body>

<div id="calendar" class="calendar"></div>

<div id="popup" class="popup" style="display:none;">
  <input id="popup-title" placeholder="Event Title" />
  <input id="popup-date" type="date" />
  <input id="popup-start" type="time" />
  <input id="popup-end" type="time" />
  <select id="popup-category">
    <option value="Study">Study</option>
    <option value="Exercise">Exercise</option>
    <option value="Rest">Rest</option>
    <option value="Work">Work</option>
    <option value="Gaming">Gaming</option>
    <option value="Lunch">Lunch</option>
    <option value="Chill Time">Chill Time</option>
  </select>
  <div style="text-align: right;">
    <button onclick="saveChanges()">Save</button>
    <button onclick="duplicateEvent()">Duplicate</button>
    <button onclick="deleteEvent()">Delete</button>
    <button onclick="closePopup()">Close</button>
  </div>
</div>

<div id="overlay" class="overlay" style="display:none;" onclick="closePopup()"></div>

<script>
  const calendarEl = document.getElementById("calendar");
  const popupEl = document.getElementById("popup");
  const overlayEl = document.getElementById("overlay");
  const popupTitle = document.getElementById("popup-title");
  const popupDate = document.getElementById("popup-date");
  const popupStart = document.getElementById("popup-start");
  const popupEnd = document.getElementById("popup-end");
  const popupCategory = document.getElementById("popup-category");

  let selectedEvent = null;

  const startHour = 0;
  const endHour = 24;
  const slotHeight = 50; // px per hour

  const events = [
    {
      title: "Study",
      start: new Date("2025-06-17T09:00:00"),
      end: new Date("2025-06-17T10:30:00"),
      category: "Study",
    },
    {
      title: "Lunch",
      start: new Date("2025-06-17T12:30:00"),
      end: new Date("2025-06-17T13:15:00"),
      category: "Lunch",
    },
    {
      title: "Rest",
      start: new Date("2025-06-17T15:00:00"),
      end: new Date("2025-06-17T16:00:00"),
      category: "Rest",
    }
  ];

  const categories = {
    Study: "#bbdefb",
    Exercise: "#c8e6c9",
    Rest: "#ffe0b2",
    Work: "#d1c4e9",
    Gaming: "#f8bbd0",
    Lunch: "#ffccbc",
    "Chill Time": "#e0f7fa"
  };

  function renderCalendar() {
    calendarEl.innerHTML = "";

    const now = new Date();
    const today = now.toISOString().split("T")[0];

    // Headers
    calendarEl.appendChild(document.createElement("div")); // empty corner
    for (let i = 0; i < 7; i++) {
      const day = new Date();
      day.setDate(day.getDate() + i);
      const dayName = day.toLocaleDateString(undefined, { weekday: "short", day: "numeric" });
      const div = document.createElement("div");
      div.textContent = dayName;
      div.className = "calendar-header";
      calendarEl.appendChild(div);
    }

    // Time rows and columns
    for (let h = startHour; h < endHour; h++) {
      const timeLabel = document.createElement("div");
      timeLabel.className = "time-cell";
      timeLabel.textContent = `${String(h).padStart(2, "0")}:00`;
      calendarEl.appendChild(timeLabel);

      for (let d = 0; d < 7; d++) {
        const col = document.createElement("div");
        col.className = "day-column";
        col.style.height = `${slotHeight}px`;
        calendarEl.appendChild(col);
      }
    }

    // Add events
    events.forEach(event => {
      const dayOffset = (event.start.getDay() + 6) % 7;
      const startHours = event.start.getHours() + event.start.getMinutes() / 60;
      const endHours = event.end.getHours() + event.end.getMinutes() / 60;

      const top = (startHours - startHour) * slotHeight;
      const height = (endHours - startHours) * slotHeight;

      const index = (startHour + (endHour - startHour)) * 7 + 1;
      const eventDiv = document.createElement("div");
      eventDiv.className = "event";
      eventDiv.textContent = event.title;
      eventDiv.style.top = `${top}px`;
      eventDiv.style.left = `calc(${(dayOffset + 1)} * (100% / 8))`;
      eventDiv.style.height = `${height}px`;
      eventDiv.style.background = categories[event.category] || "#ccc";
      eventDiv.style.width = "calc(100% / 8 - 10px)";
      eventDiv.style.position = "absolute";
      eventDiv.onclick = () => openPopup(event);

      calendarEl.appendChild(eventDiv);
    });

    // Now line
    const line = document.createElement("div");
    line.className = "now-line";

    const hourOffset = now.getHours() + now.getMinutes() / 60;
    const top = (hourOffset - startHour) * slotHeight;
    line.style.top = `${top}px`;

    const colIndex = now.getDay() === 0 ? 6 : now.getDay() - 1;
    line.style.left = `calc(${(colIndex + 1)} * (100% / 8))`;
    line.style.width = "calc(100% / 8)";
    calendarEl.appendChild(line);
  }

  function openPopup(event) {
    selectedEvent = event;
    popupTitle.value = event.title;
    popupDate.value = event.start.toISOString().split("T")[0];
    popupStart.value = event.start.toTimeString().slice(0, 5);
    popupEnd.value = event.end.toTimeString().slice(0, 5);
    popupCategory.value = event.category;
    popupEl.style.display = "block";
    overlayEl.style.display = "block";
  }

  function closePopup() {
    popupEl.style.display = "none";
    overlayEl.style.display = "none";
  }

  function saveChanges() {
    if (!selectedEvent) return;
    selectedEvent.title = popupTitle.value;
    selectedEvent.category = popupCategory.value;
    selectedEvent.start = new Date(`${popupDate.value}T${popupStart.value}`);
    selectedEvent.end = new Date(`${popupDate.value}T${popupEnd.value}`);
    renderCalendar();
    closePopup();
  }

  function deleteEvent() {
    if (!selectedEvent) return;
    const idx = events.indexOf(selectedEvent);
    if (idx !== -1) events.splice(idx, 1);
    renderCalendar();
    closePopup();
  }

  function duplicateEvent() {
    if (!selectedEvent) return;
    const newEvent = {
      ...selectedEvent,
      start: new Date(selectedEvent.start.getTime()),
      end: new Date(selectedEvent.end.getTime())
    };
    events.push(newEvent);
    renderCalendar();
  }

  renderCalendar();
  setInterval(renderCalendar, 60 * 1000); // refresh every minute
</script>

</body>
</html>
